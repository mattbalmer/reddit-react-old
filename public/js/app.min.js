!function(a,b){b.reddit=a,api=function(){var a={};return a.request=function(a){var b=new XMLHttpRequest,c=Q.defer();return b.open("GET",a,!0),b.onload=function(){if(b.status>=200&&b.status<400){try{var a=JSON.parse(b.responseText);b.data=a}catch(d){b.data={}}c.resolve(b)}else b.data={},c.reject(b)},b.onerror=function(){c.reject(b)},b.send(),c.promise},a.r=function(b){return a.request("/r/"+b)},a}();var c=React.createClass({displayName:"PostDetails",getInitialState:function(){return{post:{}}},render:function(){var a=this.props.post.data,b=React.addons.classSet,c=b({"post-details":!0});return React.DOM.div({className:c},a)}}),d=React.createClass({displayName:"PostList",getInitialState:function(){return{activePost:{}}},onPostSelected:function(a){this.state.activePost==a&&(a={}),this.setState({activePost:a}),this.props.onClick(a),console.log("post selected",a)},render:function(){var a=this.props.posts.map(function(a,b){return e({post:a,id:b+1,onClick:this.onPostSelected,activePost:this.state.activePost})},this);return React.DOM.section({className:"posts"},a)}}),e=React.createClass({displayName:"Post",onClick:function(){window.selectPost(this.props.post),this.props.onClick(this.props.post.data)},timeAgo:function(a){var b=Date.now()-1e3*a,c=parseInt(b/1e3),d=parseInt(c/60),e=parseInt(d/60),f=parseInt(e/24),g="";return f&&(g+=f+" days "),e&&(g+=e%24+" hours "),f||e||!d||(g+=d%60+" minutes "),f||e||d||!c||(g+=c%60+" seconds "),g+"ago"},render:function(){var a=this.props.post.data,b=React.addons.classSet,c=b({post:!0,active:a.id==this.props.activePost.id}),d=b({thumb:!0,hide:!a.thumbnail});return React.DOM.div({className:c,onClick:this.onClick},React.DOM.span({className:"id"},this.props.id),React.DOM.span({className:"score"},a.score),React.DOM.img({className:d,src:a.thumbnail}),React.DOM.section({className:"details"},React.DOM.a({target:"_blank",href:a.url,className:"title"},a.title),React.DOM.span({className:"when"},"Posted ",this.timeAgo(a.created_utc)),React.DOM.span({className:"author"},"by ",a.author),React.DOM.span({className:"subreddit"},"to /r/",a.subreddit),React.DOM.span({className:"comment-count"},a.num_comments," comments")))}}),f=React.createClass({displayName:"SortOption",onClick:function(){console.log("CLICK!",this.props.mode),i.fetch("all",this.props.mode.toLowerCase())},render:function(){var a=this.props.mode.toLowerCase(),b=a+" btn btn-default";return this.props.active&&(b+=" active"),React.DOM.button({type:"button",onClick:this.onClick,className:b},this.props.mode)}}),g=React.createClass({displayName:"Sort",render:function(){var a=(React.addons.classSet,this.props.mode),b=["Hot","New","Top"],c=b.map(function(b){return f({mode:b,active:b.toLowerCase()==a.toLowerCase()})});return React.DOM.div({className:"btn-group"},c)}}),h=React.createClass({displayName:"SubredditSearch",getInitialState:function(){return{value:this.props.title||"all"}},onSubmit:function(){return this.refs.searchInput.getDOMNode().blur(),i.fetch(this.state.value),!1},onChange:function(a){this.setState({value:a.target.value})},render:function(){var a=this.state.value;return React.DOM.form({className:"form-inline",onSubmit:this.onSubmit},React.DOM.div({className:"input-group"},React.DOM.input({ref:"searchInput",type:"text",className:"form-control",value:a,onChange:this.onChange}),React.DOM.div({className:"input-group-btn"},React.DOM.button({type:"submit",onClick:this.onSubmit,className:"btn btn-primary"},"Go"))))}}),i=function(a){var b={};return b.fetch=function(b,e){e=e||"hot",a.r(b+"/"+e).then(function(a){var b=a.data.data.children,f={},i=function(a){f=a};React.renderComponent(c({post:f}),document.getElementById("Comments")),React.renderComponent(d({posts:b,onClick:i}),document.getElementById("Main")),React.renderComponent(h(null),document.getElementById("SubredditSearch")),React.renderComponent(g({mode:e}),document.getElementById("SortOptions"))})},b.fetch("all"),b}(api);"undefined"!=typeof b&&(b.reddit=i)}({},function(){return this}());